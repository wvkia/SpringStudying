索引的本质

我们知道索引是用来提供数据查询速度的，但是怎么提高查询速度，不加索引的话又怎么减慢速度了？

现在数据库表都是以一张二维表的形式组织数据，仅仅是抽象的意义，不代表磁盘实际组织形式，这个时候假设有张表 A ，我们需要查询其中一个字段``select * from A where name='BB'``，这个时候数据库会怎么查找？

数据库就必须一行一行的匹配name字段，找到一个缓存一个，必须把整张表找完。
数据库表记录的查询，其实就是查询算法的问题，我们必须要提高查询速度才能满足在高并发下的系统表现。

这样一行一行的查找效率为O(n)，效率很差，根据查询算法中，折半查找的效率最高，其中二叉树就是一个表现，效率为O(logN)，但二分法的关键在于必须是排序的。

OK，查找效率的问题解决了，怎么把字段值映射到二叉树上呢，答案就是索引。索引的本质就是一种便于查找的数据结构。
其中索引的本质就是排序。

我们可以把建索引的列值，构建一个排序二叉树数据结构，不可能把整个行值作为节点值，因为这样会把整张表都复制一份，通常节点保存的是列的值和值所在行位置指针，这样就可以查到索引节点并且找到对应的行。

问题解决了！

但事物都是有两面性的，索引可以让数据库查询速度上升，但写入的时候效率就会下降，因为排序二叉树需要始终维持在一个正确的状态，增删改数据需要改变二叉树结构，每次数据改变，DBMS都会重新梳理树的结构确保排序的正确性。会有写入性能损失。
这也是高并发情况下需要读写分离。
同时索引的二叉树结构也是需要占用空间的，表越大，索引越大。

对于索引的数据接结构，通常使用二叉树，但是普通的二叉树在数据插入删除的时候会重新全部排序，成本很高，所以通常使用B树。

理解了上述原理后，就能知道索引什么时候有效，以及书写语句的注意事项：
**单索引**
1. 只对键值本身提条件，很有效
2. 但如果是对键值的函数查询，是不行的，需要在函数上建索引才可以
3. 多个查询条件时，索引最好放外面单独用来过滤范文
  > ```language
  > 如果是select * from table where name="A" and age="b"，这个时候如果对name或者age创建索引的话，可以提高效率，因为可以根据索引缩小范围，但
  > select * from table where name="A" or age="B"这个时候就不可以了，因为都是需要遍历全表的
	```

**多索引**
多索引有两种，一种是多个字段都创建索引，另一种是多个字段创建索引
对于第一种，如果AB都有索引，查询 A=1 and B=2时，会先索引A过滤A=1范围，对B并没有效，这时候B=2只能硬性遍历。

但如果是第二种，AB双字段创建索引，用A=1过滤后的结果集对B也是有效的，就可以继续B=2索引，可以提高效率；但是AB双字段索引对单独的B=2是没有效果的

AB双字段索引是怎么创建的呢？
首先是对A做个索引，再对AB同时做个索引，对于A=？and B=？时先对A进行索引，然后在索引范围中对A=？andB=？进行索引，
所以我们可以完整些说，A,B,C这样的多字段索引，对于A=?，A=? AND B=?，A=? AND B=? AND C=?这类条件都有效，但对于B=?，C=?，B=? AND C=?这种条件是无效的，还需要重新建立关于B或C的索引。

所以多字段索引的创建要注意字段顺序

https://cloud.tencent.com/developer/article/1030454